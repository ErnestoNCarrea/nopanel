#!/bin/bash

nopanel_web_domain_add() {
    if [[ "$param_help" ]]; then
        nopanel web help
        return
    fi

    if [[ ! "$param_user" ]]; then
        nopanel_command_return 'error' 'Username not specified (--user)'
        return
    fi
    if [[ ! "$param_domain" ]]; then
        nopanel_command_return 'error' 'Domain name not specified'
        return
    fi

    source $NOPANEL_LIB/domain.inc

    # Default values
    [[ ! "$param_php" ]] && param_php='no'

    # Update noPanel DB
    nopanel_command_echo "Adding domain $param_domain for user $param_user..."

    nplib_domains_set "$param_domain" 'name' "$param_domain"
    nplib_domains_set "$param_domain" 'user' "$param_user"
    nplib_domains_set "$param_domain" 'web' 'true'
    nplib_domains_set "$param_domain" 'web_aliases' "$param_aliases"
    nplib_domains_set "$param_domain" 'web_php' "$param_php"

    # Build configuration for domain
    nopanel web domain rebuild

    # Resload web server config
    nopanel module apache reload

    nopanel_command_return 'ok' 'Domain added'
}
